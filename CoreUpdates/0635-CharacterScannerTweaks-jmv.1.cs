'From Cuis 2.9 of 5 November 2010 [latest update: #634] on 8 November 2010 at 4:25:25 pm'!!CompositionScanner methodsFor: 'stop conditions' stamp: 'jmv 11/8/2010 16:23'!columnBreak	"Answer true. Set up values for the text line interval currently being 	composed."	line stop: lastIndex.	spaceX _ destX.	line paddingWidth: rightMargin - spaceX - 1.	^true! !!CompositionScanner methodsFor: 'stop conditions' stamp: 'jmv 11/8/2010 16:23'!cr	"Answer true. Set up values for the text line interval currently being 	composed."	line stop: lastIndex.	spaceX _ destX.	line paddingWidth: rightMargin - spaceX - 1.	^true! !!CompositionScanner methodsFor: 'stop conditions' stamp: 'jmv 11/8/2010 16:23'!crossedX	"There is a word that has fallen across the right edge of the composition 	rectangle. This signals the need for wrapping which is done to the last 	space that was encountered, as recorded by the space stop condition."	spaceCount >= 1 ifTrue: [		"The common case. First back off to the space at which we wrap."		line stop: spaceIndex.		lineHeight _ lineHeightAtSpace.		baseline _ baselineAtSpace.		spaceCount _ spaceCount - 1.		spaceIndex _ spaceIndex - 1.		"Check to see if any spaces preceding the one at which we wrap.			Double space after punctuation, most likely."		[(spaceCount > 1 and: [(text at: spaceIndex) = Character space])]			whileTrue: [				spaceCount _ spaceCount - 1.				"Account for backing over a run which might					change width of space."				font _ text fontAt: spaceIndex.				spaceIndex _ spaceIndex - 1.				spaceX _ spaceX - (font widthOf: Character space)].		line paddingWidth: rightMargin - spaceX - 1.		line internalSpaces: spaceCount]	ifFalse: [		"Neither internal nor trailing spaces -- almost never happens."		lastIndex _ lastIndex - 1.		[ destX <= rightMargin or: [ lastIndex = 0]]			whileFalse: [				destX _ destX - (font widthOf: (text at: lastIndex)).				lastIndex _ lastIndex - 1].		spaceX _ destX.		line paddingWidth: rightMargin - destX - 1.		line stop: (lastIndex max: line first)].	^true! !!CompositionScanner methodsFor: 'stop conditions' stamp: 'jmv 11/8/2010 16:24'!endOfRun	"Answer true if scanning has reached the end of the paragraph. 	Otherwise step conditions (mostly install potential new font) and answer 	false."	| runLength |	lastIndex = text size		ifTrue:	[			line stop: lastIndex.			spaceX _ destX.			line paddingWidth: rightMargin - destX - 1.			^true]		ifFalse:	[			runLength _ (text runLengthFor: (lastIndex _ lastIndex + 1)).			runStopIndex _ lastIndex + (runLength - 1).			self setStopConditions.			self placeEmbeddedObject.			^false]! !