'From Cuis 3.2 of 12 April 2011 [latest update: #914] on 9 May 2011 at 4:01:33 am'!!MenuMorph methodsFor: 'construction' stamp: 'cbr 5/6/2011 15:15'!addStayUpIcons	| closeBox pinBox w |		self flag: #todo. "Remediate."		(self valueOfProperty: #hasStayUpIcons ifAbsent: [ false ])		ifTrue: [		 	self removeProperty: #needsStayUpIcons.			^self ].	titleMorph ifNil: [		"Title not yet there. Flag ourself, so this method is called again when adding title."		self setProperty: #needsStayUpIcons toValue: true.		^ self].	closeBox _ PluggableButtonMorph model: self action: #delete.	closeBox icon: Theme current closeMenuIcon.	pinBox _ PluggableButtonMorph model: self action: #stayUp.	pinBox icon: Theme current pushPinIcon.	w _ (titleMorph hasSubmorphs ifTrue: [ titleMorph firstSubmorph width ] ifFalse: [ 0 ]) + 42.	self addMorphFront: 		(LayoutMorph newRow			height: (titleMorph height max: 19);			width: w;	"Make room for buttons"			color: Color transparent;			addMorph: closeBox fixedWidth: 20;			addMorph: titleMorph proportionalWidth: 1;			addMorph: pinBox fixedWidth: 20).	self setProperty: #hasStayUpIcons toValue: true.	self removeProperty: #needsStayUpIcons! !!MenuMorph methodsFor: 'control' stamp: 'cbr 4/29/2011 07:43'!popUpAt: aPoint forHand: hand in: aWorld allowKeyboard: aBoolean 	"Present this menu at the given point under control of the given hand."	| evt |	self items isEmpty ifTrue: [^self].	Theme current decorateMenu: self.	(self submorphs select: [:m | m isKindOf: UpdatingMenuItemMorph]) 		do: [:m | m updateContents].	self 		positionAt: aPoint		relativeTo: (selectedItem ifNil: [self items first])		inWorld: aWorld.	aWorld addMorphFront: self.	"Acquire focus for valid pop up behavior"	hand newMouseFocus: self.	aBoolean ifTrue: [hand newKeyboardFocus: self].	evt := hand lastEvent.	(evt isKeyboard or: [evt isMouse and: [evt anyButtonPressed not]]) 		ifTrue: [			"Select first item if button not down"			self moveSelectionDown: 1 event: evt]! !