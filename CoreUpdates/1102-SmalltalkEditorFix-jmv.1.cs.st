'From Cuis 3.3 of 2 June 2011 [latest update: #1024] on 4 October 2011 at 10:27:45 am'!!SmalltalkEditor methodsFor: 'do-its' stamp: 'jmv 10/4/2011 10:26'!evaluateSelectionAndDo: aBlock ifFail: failBlock	"Treat the current selection as an expression; evaluate it and return the result	3 +4	"	| provider result rcvr ctxt |	self lineSelectAndEmptyCheck: [^ ''].	provider _ self codeProvider.	(provider respondsTo: #doItReceiver) 		ifTrue: [				rcvr _ provider doItReceiver.				ctxt _ provider doItContext]		ifFalse: [rcvr _ ctxt _ nil].	result _ [		rcvr class evaluatorClass new			sourceStreamGetter: #selectionAsStream;		"Cuis specific. Do not remove!!"			evaluate: self selectionAsStream			in: ctxt			to: rcvr			notifying: self			ifFail: [^ failBlock value]			logged: true.	] 		on: OutOfScopeNotification 		do: [ :ex | ex resume: true].	morph formatAndStyleIfNeeded.		"Needed to re-shout workspaces, that might have new variables binded."	^ aBlock value: result! !