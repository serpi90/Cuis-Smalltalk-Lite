'From Cuis 3.0 of 18 January 2011 [latest update: #768] on 28 January 2011 at 10:28:09 am'!!Text methodsFor: 'private' stamp: 'jmv 1/28/2011 10:22'!fixParagraphAttributesFrom: start to: end	"Helper method to ensure the invariant that TextAttributes that answer true to	 #isParagraphAttribute are only applied to whole paragraphs.	See senders"		| paragraphEnd paragraphInterval paragraphStart paragraphAttributes|		paragraphEnd _ end max: start.	"end could be start-1 when new text is empty, for example, when backspacing"	[		paragraphInterval _ self encompassParagraph: (paragraphEnd to: paragraphEnd).		paragraphStart _ paragraphInterval first.		paragraphEnd _ paragraphInterval last.			"We must honor the paragraph attributes as defined in the Character enter that ends the paragraph"		paragraphAttributes _ (self attributesAt: paragraphEnd) select: [ :attr | attr isParagraphAttribute ].		"if paragraphEnd is inside the interval just modified, and it doesn't bring any paragraph attributes (i.e., it doesn't end in CR),		then try to keep the paragraph attributes previously in use in this paragraph..		This is needed, for example, when pasting an image  or a plain text at the end of the document"		(paragraphEnd = end and: [ paragraphStart < start and: [ end > 0 and: [ ((string at: end) = Character cr) not ]]]) ifTrue: [			paragraphAttributes _ (self attributesAt: paragraphStart) select: [ :attr | attr isParagraphAttribute ]].		self privateSetParagraphAttributes: paragraphAttributes from: paragraphStart to: paragraphEnd.		paragraphEnd _ paragraphStart - 1.		paragraphStart > start ] whileTrue.	runs coalesce! !