'From Cuis 3.3 of 2 June 2011 [latest update: #1024] on 9 June 2011 at 5:00:27 pm'!!TextEditor methodsFor: 'accessing-selection' stamp: 'jmv 6/9/2011 10:26'!markIndex	markBlock ifNil: [^1].	^ markBlock stringIndex! !!TextEditor methodsFor: 'initialize-release' stamp: 'jmv 6/9/2011 10:30'!initialize	selectionStartBlocks _ #().	selectionStopBlocks _ #()! !!TextEditor methodsFor: 'private' stamp: 'jmv 6/9/2011 10:16'!zapSelectionWith: replacement	| start stop rep |	start _ self startIndex.	stop _ self stopIndex.	(replacement isEmpty and: [stop > start]) ifTrue: [		"If deleting, then set emphasisHere from 1st character of the deletion"		emphasisHere _ (self text attributesAt: start) select: [:att | att mayBeExtended]].	(start = stop and: [ replacement isEmpty ]) ifFalse: [		(replacement is: #Text)			ifTrue: [				"If we are pasting a text that doesn't bring a ParagraphStyleReference in the last paragraph, and we need it,				but it won't be provided by our text, as we are at the end, then add any paragraph attribute from emphasisHere.				Note: If we are replacing all the current text (or we have no current text), then just leave whatever comes with replacement"				(replacement notEmpty and: [ (replacement last = Character cr) not and: [ stop > self text size and: [ start > 1 ]]])					ifTrue: [						rep _ (replacement, (Text string: String cr attributes: emphasisHere)) copyFrom: 1 to: replacement size ]					ifFalse: [ rep _ replacement ]]			ifFalse: [ rep _ Text string: replacement attributes: emphasisHere ].		self text replaceFrom: start to: stop - 1 with: rep.		paragraph			recomposeFrom: start			to:  start + rep size - 1			delta: rep size - (stop-start).		self markIndex: start pointIndex: start + rep size.		selectionStartBlocks _ #().		selectionStopBlocks _ #().		UndoInterval _ self selectionInterval.		self userHasEdited  " -- note text now dirty" ].	morph possiblyChanged! !