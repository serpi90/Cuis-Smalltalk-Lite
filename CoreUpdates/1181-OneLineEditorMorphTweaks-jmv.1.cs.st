'From Cuis 4.0 of 16 November 2011 [latest update: #1144] on 20 December 2011 at 4:51:49 pm'!!Editor methodsFor: 'private' stamp: 'jmv 12/20/2011 15:59'!    beginningOfParagraph: position	| s |	s _ self privateCurrentString.	^ (s		lastIndexOf: Character cr		startingAt: (position min: s size)		ifAbsent: [ 0 ]) + 1.! !!OneLineEditorMorph methodsFor: 'drawing' stamp: 'jmv 12/20/2011 16:36'!             displayInsertionMarkAtX: x top: top bottom: bottom emphasis: emphasis on: aCanvas	| caretColor x1 isBold isItalic x0 h w halfW r d |	isBold _ emphasis allMask: 1.	isItalic _ emphasis allMask: 2.	caretColor _ Theme current insertionPoint.	h _ bottom - top.	w _ isBold		ifTrue: [ h // 25 + 2 ]		ifFalse: [ h // 30 + 1 ].	halfW _ w // 2.	isItalic		ifTrue: [				"Keep tweaking if needed!!"			d _ isBold ifTrue: [ 3 ] ifFalse: [ h // 24].			x0 _ x- (h*5//24) + d.			x1 _ x + d ]		ifFalse: [			x0 _ x.			x1 _ x].	x0 < halfW ifTrue: [		x1 _ x1 - x0 + halfW.		x0 _ halfW ].	r _ bounds right-halfW-1.	r < x1 ifTrue: [		x0 _ x0 + r - x1.		x1 _ r ].	caretRect _ x0-halfW-1@ top corner: x1+halfW+1+1 @ bottom.	aCanvas		line: x0@(bottom-halfW) to: x1@(top+halfW)		width: w color: caretColor! !!OneLineEditorMorph methodsFor: 'events-processing' stamp: 'jmv 12/20/2011 16:24'!  focusKeyboardFor: aKeyboardEvent	"If aKeyboardEvent tab or shift-tab use it to navigate keyboard focus.	ctrl key ignored."	aKeyboardEvent keyValue = 9		ifFalse: [ ^false ].	aKeyboardEvent shiftPressed		ifFalse: [ aKeyboardEvent hand keyboardFocusNext ]		ifTrue: [ aKeyboardEvent hand keyboardFocusPrevious ].	^ true! !!OneLineEditorMorph methodsFor: 'events-processing' stamp: 'jmv 12/20/2011 16:31'!     keyboardFocusChange: aBoolean 	aBoolean		ifTrue: [			"A hand is wanting to send us characters..."			editor ifNil: [ self editor ].	"Forces install"			self selectAll.			self startBlinking ]		ifFalse: [			self stopBlinking.			keyboardFocusWatcher ifNotNil: [				keyboardFocusWatcher lostFocus: self ]].	self redrawNeeded! !