'From Cuis 3.2 of 12 April 2011 [latest update: #914] on 20 May 2011 at 10:25:21 am'!!FloatMatrix methodsFor: 'image processing' stamp: 'jmv 5/15/2011 10:04'!convolutionWith: aForm	"Warning: Slow."	"	| f m |	f _ Form fromUser.	m _ FloatMatrix m: 3 n: 3.	m fillGaussian.	(m convolutionWith: f) display	"	| resultWidth resultHeight result xx yy blue c green red k |	resultWidth _ self width + aForm width - 1.	resultHeight _ self height + aForm height - 1.	k _ 1.0 / elements sum.	result _ Form extent: resultWidth@resultHeight depth: 32.	1 to: resultHeight do: [ :y |		1 to: resultWidth do: [ :x |			red _ 0.0.			green _ 0.0.			blue _ 0.0.			1 to: self height do: [ :j |				1 to: self width do: [ :i |					xx _ x-i+1.					yy _ y-j+1.					(xx > 0) & (xx <= aForm width) & (yy > 0) & (yy <= aForm height)						ifTrue: [							c _ aForm colorAt: xx@yy.							red _ c red * (self i: i j: j) + red.							green _ c green * (self i: i j: j) + green.							blue _ c blue * (self i: i j: j) + blue ]]].			red _ red * k min: 1.0 max: 0.0.			green _ green * k min: 1.0 max: 0.0.			blue _ blue * k min: 1.0 max: 0.0.			result colorAt: x@y put:				(Color r: red g: green b: blue).		].	].	^result! !